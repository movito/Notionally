# Notionally v2.0.0 Release Notes

**Release Date:** 2025-09-30
**Branch:** `feature/v2.0.0-notion-api-prep`
**Type:** Minor Release (Non-Breaking)
**Focus:** Preparation for Notion API 2025-09-03

---

## Overview

Version 2.0.0 is a **preparation release** that upgrades our Notion SDK and adds optional support for data source IDs, preparing the codebase for the upcoming v2.0.0 breaking changes required by Notion's new API version.

**Key Point:** This release is **100% backward compatible**. All existing configurations and workflows continue to work without any changes.

---

## What's New

### 1. SDK Upgrade
- **Upgraded:** `@notionhq/client` from v2.2.15 ‚Üí v5.1.0
- **Benefit:** Access to latest Notion API features and bug fixes
- **Impact:** None on existing functionality

### 2. Data Source ID Support
- **New Method:** `fetchDataSourceId()` - Retrieves data source ID for your database
- **New Method:** `ensureDataSourceId()` - Automatically fetches if not configured
- **New Config:** `notion.dataSourceId` (optional)
- **New Config:** `notion.apiVersion` (optional)

### 3. Migration Helper
```bash
npm run fetch-data-source-id
```
New script that:
- Connects to your Notion database
- Retrieves the data source ID
- Provides clear instructions for updating your config
- Prepares you for v2.0.0

### 4. Environment Variables
Added optional environment variables:
```bash
NOTION_DATA_SOURCE_ID=your_data_source_id_here
NOTION_API_VERSION=2025-09-03
```

### 5. Warning Messages
If data source ID is not configured, you'll see:
```
‚ö†Ô∏è  Notionally v2.0.0 will require a data source ID. Run setup to prepare for the upgrade.
```

---

## Breaking Changes

**NONE** - This release is fully backward compatible.

---

## Migration Path

### For Existing Users (v1.7.5 ‚Üí v2.0.0)

**Option 1: Do Nothing (Recommended for now)**
```bash
git pull
npm install
npm start
```
Everything continues to work as before.

**Option 2: Prepare for v2.0.0 (Recommended)**
```bash
git pull
npm install
npm run fetch-data-source-id
# Follow the instructions to update your config
npm start
```

### New Users

Follow the standard setup:
```bash
npm install
npm run setup
npm start
```

The setup process now optionally fetches data source ID.

---

## Testing Completed

‚úÖ **Backward Compatibility**
- Existing configs without `dataSourceId` work perfectly
- No functional changes to existing features
- All API calls continue to use current patterns

‚úÖ **Module Loading**
- NotionClient loads successfully with new SDK
- ConfigManager handles optional new fields
- No runtime errors with missing data source ID

‚úÖ **New Features**
- `fetchDataSourceId()` successfully retrieves data source IDs
- Migration helper script runs without errors
- Configuration files updated correctly

---

## What Happens Next?

### Phase 1: v2.0.0 (Current)
- ‚úÖ SDK upgraded
- ‚úÖ Data source detection added
- ‚úÖ Migration tools provided
- ‚úÖ Warnings implemented
- **Status:** Ready for merge to main

### Phase 2: v2.0.0 (Future - Estimated 2-4 weeks)
- ‚è≥ Make `dataSourceId` required
- ‚è≥ Update all API calls to use `data_source_id`
- ‚è≥ Update `createPage()` to use new API
- ‚è≥ Update `findPageByUrl()` to use `dataSources.query()`
- ‚è≥ Create comprehensive migration guide

---

## Files Changed

### Modified
1. `/local-app/package.json` - Version bump, SDK upgrade, new script
2. `/local-app/src/notion-client.js` - Added data source methods
3. `/local-app/src/config/ConfigManager.js` - Support new optional fields
4. `/local-app/config.example.json` - Added new config options
5. `/local-app/.env.example` - Added new environment variables
6. `/CHANGELOG.md` - Documented v2.0.0 changes

### New Files
1. `/local-app/scripts/fetch-data-source-id.js` - Migration helper
2. `/docs/development/NOTION_API_MIGRATION_PLAN.md` - Full migration strategy
3. `/docs/development/V2.0.0_RELEASE_NOTES.md` - This file

---

## Rollback Procedure

If issues arise, rollback is simple:

```bash
git checkout main
npm install
npm start
```

Your v1.7.5 configuration will continue to work.

---

## User Communication

### Release Announcement Draft

**Subject:** Notionally v2.0.0 Released - Preparing for Notion API Updates

**Body:**

We've released Notionally v2.0.0, a preparation release for upcoming Notion API changes.

**What you need to know:**
- ‚úÖ This release is fully backward compatible
- ‚úÖ No action required immediately
- ‚úÖ Everything continues to work as before
- üí° Optional: Run `npm run fetch-data-source-id` to prepare for v2.0.0

**What's new:**
- Upgraded Notion SDK to latest version (v5.1.0)
- Added tools to prepare for future API changes
- New migration helper script

**What's coming:**
- v2.0.0 (in 2-4 weeks) will require a data source ID
- Migration guide will be provided
- Automated migration tools available

**Update now:**
```bash
git pull
npm install
npm start
```

---

## Technical Details

### API Version Handling

The NotionClient now accepts an optional API version:

```javascript
// Current (default)
new Client({ auth: apiKey })

// v2.0.0+ (optional)
new Client({
    auth: apiKey,
    notionVersion: "2025-09-03"
})
```

### Data Source ID Detection

```javascript
// Manual fetch
const dataSourceId = await notionClient.fetchDataSourceId();

// Automatic (lazy)
await notionClient.ensureDataSourceId();
```

### Configuration Schema

```javascript
{
  "notion": {
    "apiKey": "secret_...",           // Required
    "databaseId": "abc123...",         // Required
    "dataSourceId": "abc123...",       // Optional (v2.0.0), Required (v2.0.0)
    "apiVersion": "2025-09-03"         // Optional
  }
}
```

---

## Known Issues

**None identified** - This is a clean preparation release.

---

## Support

For questions or issues:
1. Check the migration plan: `/docs/development/NOTION_API_MIGRATION_PLAN.md`
2. Run diagnostics: `npm run check`
3. Open an issue on GitHub

---

## Acknowledgments

This release prepares Notionally for Notion's multi-source database API update, ensuring a smooth transition to v2.0.0 while maintaining full backward compatibility.

---

## Next Actions

### For Maintainers
1. ‚úÖ Test v2.0.0 thoroughly
2. ‚úÖ Merge `feature/v2.0.0-notion-api-prep` to `main`
3. ‚úÖ Tag release: `git tag v2.0.0`
4. ‚úÖ Tag stable: `git tag stable-v2.0.0`
5. ‚úÖ Create GitHub release with these notes
6. ‚è≥ Gather user feedback (2-4 weeks)
7. ‚è≥ Begin v2.0.0 development

### For Users
1. Update to v2.0.0: `git pull && npm install`
2. (Optional) Prepare for v2.0.0: `npm run fetch-data-source-id`
3. Continue using Notionally as normal
4. Watch for v2.0.0 release announcement

---

**Version:** 2.0.0
**Status:** Ready for Release
**Compatibility:** Backward compatible with v1.7.5
**Security:** No security changes
**Performance:** No performance impact
