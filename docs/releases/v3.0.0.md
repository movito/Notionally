# Notionally v3.0.0 Release Notes

**Release Date:** 2025-10-02
**Type:** Major Release (BREAKING CHANGES)
**Branch:** `feature/v3.0.0-notion-api-2025-09-03`
**Previous Version:** v2.0.0

---

## ‚ö†Ô∏è BREAKING CHANGES

**This release contains BREAKING CHANGES that require configuration updates.**

**You MUST:**
1. Run `npm run fetch-data-source-id`
2. Add `NOTION_DATA_SOURCE_ID` to your config
3. Restart the application

**Without these steps, the app will not start.**

---

## Overview

v3.0.0 implements the **Notion API 2025-09-03** specification, migrating from database-centric to data-source-centric operations. This prepares Notionally for Notion's multi-source database feature and ensures future compatibility.

### Key Changes

- ‚úÖ Now uses Notion API version 2025-09-03
- ‚úÖ All operations use `data_source_id` instead of `database_id`
- ‚úÖ Queries use `dataSources.query()` instead of `databases.query()`
- ‚úÖ `dataSourceId` changed from optional ‚Üí **REQUIRED**

---

## What's New

### Notion API 2025-09-03 Support

Full implementation of Notion's latest API version with multi-source database support.

**Technical Details:**
- `pages.create()` now uses `data_source_id` parent type
- `dataSources.query()` replaces `databases.query()`
- Default API version set to `2025-09-03`

### Required Data Source ID

**BREAKING:** `notion.dataSourceId` is now mandatory.

**Before (v2.0.0):**
```json
{
  "notion": {
    "apiKey": "...",
    "databaseId": "..."
  }
}
```

**After (v3.0.0):**
```json
{
  "notion": {
    "apiKey": "...",
    "databaseId": "...",
    "dataSourceId": "..."  // ‚Üê REQUIRED
  }
}
```

### Enhanced Validation

ConfigManager now validates presence of `dataSourceId` at startup with helpful error messages:

```
‚ùå Missing required configuration: notion.dataSourceId
   Run: npm run fetch-data-source-id
   Then add NOTION_DATA_SOURCE_ID to your config
```

### Improved Logging

Configuration logs now show:
- Data source ID (masked)
- API version in use

**Example Output:**
```
üìã Configuration loaded:
  Notion database: abc1****123
  Notion data source: abc1****123
  Notion API version: 2025-09-03
```

---

## Migration Required

### Migration Difficulty: ‚≠ê‚≠ê Medium

**Time Required:** 10 minutes
**Config Changes:** Required
**Rollback:** Easy (revert to v2.0.0)

### Quick Migration Steps

```bash
# 1. Fetch your data source ID
npm run fetch-data-source-id

# 2. Add to .env
echo "NOTION_DATA_SOURCE_ID=your_id_here" >> .env

# 3. Upgrade
git pull origin main
cd local-app && npm install
npm start
```

**Full migration guide:** `/docs/development/MIGRATION_v3.md`

---

## Breaking Changes Details

### 1. dataSourceId Now Required

**Impact:** App will not start without it

**Before:**
```javascript
// v2.0.0: Optional
this.dataSourceId = config.notion.dataSourceId || null;
```

**After:**
```javascript
// v3.0.0: Required
this.dataSourceId = config.notion.dataSourceId;
if (!this.dataSourceId) {
    throw new Error('dataSourceId is required in v3.0.0');
}
```

**Fix:**
```bash
npm run fetch-data-source-id
# Add to config
```

---

### 2. pages.create() API Change

**Impact:** Page creation uses new API

**Before:**
```javascript
// v2.0.0
parent: {
    database_id: this.databaseId
}
```

**After:**
```javascript
// v3.0.0
parent: {
    type: 'data_source_id',
    data_source_id: this.dataSourceId
}
```

**Fix:** No user action needed (automatic)

---

### 3. Database Queries Changed

**Impact:** Duplicate detection uses new API

**Before:**
```javascript
// v2.0.0
await this.notion.databases.query({
    database_id: this.databaseId,
    filter: { ... }
});
```

**After:**
```javascript
// v3.0.0
await this.notion.dataSources.query({
    data_source_id: this.dataSourceId,
    filter: { ... }
});
```

**Fix:** No user action needed (automatic)

---

### 4. Default API Version Changed

**Impact:** Uses newer API by default

**Before:**
```javascript
// v2.0.0: No default
notionVersion: config.notion.apiVersion || undefined
```

**After:**
```javascript
// v3.0.0: Defaults to 2025-09-03
notionVersion: config.notion.apiVersion || '2025-09-03'
```

**Fix:** No action needed (or override in config)

---

## What Doesn't Change

### ‚úÖ Existing Notion Pages

All your existing Notion pages remain unchanged and accessible.

### ‚úÖ Greasemonkey Script

No changes to the browser extension. Still works with v1.16.2.

### ‚úÖ Dropbox Integration

Dropbox configuration and file storage unchanged.

### ‚úÖ Database Schema

Your Notion database properties and structure unchanged.

### ‚úÖ LinkedIn Post Saving

Same workflow: Click "Save to Notion" button on LinkedIn.

---

## Technical Changes

### Files Modified

1. **notion-client.js**
   - Constructor: Requires `dataSourceId`, throws error if missing
   - `pages.create()`: Uses `data_source_id` parent type
   - `findPageByUrl()`: Uses `dataSources.query()`
   - `findExistingPage()`: Uses `dataSources.query()`
   - Default API version: `2025-09-03`

2. **ConfigManager.js**
   - Validation: Requires `dataSourceId`
   - Logging: Shows data source ID and API version
   - Error messages: Helpful instructions

3. **config.example.json**
   - Comments updated for v3.0.0
   - `dataSourceId` marked as REQUIRED

4. **package.json**
   - Version: 3.0.0

### API Endpoints Changed

| Method | v2.0.0 | v3.0.0 |
|--------|--------|--------|
| Create page | `pages.create()` with `database_id` | `pages.create()` with `data_source_id` |
| Query pages | `databases.query()` | `dataSources.query()` |
| Find existing | `databases.query()` | `dataSources.query()` |

### SDK Version

**Unchanged:** Still using `@notionhq/client` v5.1.0 (from v2.0.0)

---

## Testing Status

### ‚ö†Ô∏è Testing Required

This release requires testing before production use:

- [ ] Unit tests for new API patterns
- [ ] Integration tests with real Notion API
- [ ] Migration test from v2.0.0
- [ ] Save LinkedIn post with video
- [ ] Save LinkedIn post with images
- [ ] Duplicate detection verification

**Current Status:** Implementation complete, testing pending

---

## Rollback Plan

### If Migration Fails

**Easy rollback to v2.0.0:**

```bash
git checkout v2.0.0
cd local-app && npm install
# Restore old config (no dataSourceId needed)
npm start
```

**Rollback difficulty:** ‚≠ê Easy (5 minutes)

---

## Why This Release?

### The Problem

Notion's old API assumed one database = one data source. Their new multi-source database feature allows one database to contain multiple data sources (like multiple tables).

### The Solution

The new API requires specifying which data source you're working with, enabling:
- Multi-source databases
- Better data organization
- Future Notion features

### For Most Users

Your `dataSourceId` equals your `databaseId` because most databases have only one source. Migration is straightforward!

---

## Compatibility

### Requirements

- ‚úÖ Node.js v22.0.0+
- ‚úÖ Notion SDK v5.1.0 (already installed in v2.0.0)
- ‚úÖ Notion API 2025-09-03 (auto-configured)

### Supported Platforms

- ‚úÖ macOS (tested)
- ‚úÖ Linux (should work)
- ‚úÖ Windows (should work)

### Browser Compatibility

- ‚úÖ Firefox with Greasemonkey (unchanged)

---

## Known Issues

### None Currently

No known issues at release time.

**If you encounter issues:**
1. Check `/docs/development/MIGRATION_v3.md`
2. Verify `dataSourceId` is correct
3. Check server logs for details

---

## Security

### No Security Changes

No security vulnerabilities fixed or introduced in this release.

**Security model unchanged:**
- Local server only (localhost:8765)
- CORS restricted to LinkedIn domains
- API keys stored locally
- No external exposure

---

## Performance

### Expected Performance

**Same as v2.0.0** - no performance changes expected.

The new API endpoints (`dataSources.query()`) should perform identically to the old ones (`databases.query()`).

---

## Documentation

### New Documentation

1. `/docs/development/V3.0.0_IMPLEMENTATION_PLAN.md` - Implementation details
2. `/docs/development/MIGRATION_v3.md` - Migration guide
3. `/docs/releases/v3.0.0.md` - This document

### Updated Documentation

1. `/CHANGELOG.md` - v3.0.0 entry
2. `/local-app/config.example.json` - Updated comments
3. Code comments updated throughout

---

## Changelog Summary

### Added
- Notion API 2025-09-03 support
- Required `dataSourceId` validation
- Enhanced error messages
- Data source ID in config logging

### Changed (BREAKING)
- `dataSourceId` optional ‚Üí required
- `pages.create()` uses `data_source_id`
- `findPageByUrl()` uses `dataSources.query()`
- `findExistingPage()` uses `dataSources.query()`
- Default API version ‚Üí `2025-09-03`

### Removed
- Backward compatibility warning (no longer needed)

---

## Upgrade Checklist

Before upgrading to v3.0.0:

- [ ] Read this release note
- [ ] Read `/docs/development/MIGRATION_v3.md`
- [ ] Backup your config
- [ ] Run `npm run fetch-data-source-id`
- [ ] Add `dataSourceId` to config
- [ ] Upgrade code
- [ ] Test server starts
- [ ] Test saving a LinkedIn post

---

## Support

### Getting Help

1. **Migration issues:** See `/docs/development/MIGRATION_v3.md`
2. **Config issues:** Run `npm run fetch-data-source-id` again
3. **API errors:** Check Notion integration permissions

### Reporting Issues

If you encounter problems:
1. Check server logs (`npm run dev`)
2. Verify config has `dataSourceId`
3. Test Notion connection: `curl http://localhost:8765/test-notion`

---

## Timeline

| Event | Date |
|-------|------|
| v2.0.0 Released | 2025-10-01 |
| v3.0.0 Development Started | 2025-10-02 |
| v3.0.0 Implementation Complete | 2025-10-02 |
| v3.0.0 Testing | TBD |
| v3.0.0 Release | TBD |

---

## Credits

**Developed by:** Fredrik Matheson
**AI Assistant:** Claude (Anthropic)
**Notion SDK:** @notionhq/client v5.1.0

---

## Next Steps After Upgrading

1. ‚úÖ Verify server starts without errors
2. ‚úÖ Check config logs show data source ID
3. ‚úÖ Test saving a LinkedIn post
4. ‚úÖ Verify post appears in Notion
5. ‚úÖ Monitor for any errors

**All working?** You're on v3.0.0! üéâ

---

## Future Roadmap

### Planned for Future Releases

- Video saving improvements
- Image processing enhancements
- Batch processing support
- Performance optimizations

### When Notion Enforces API 2025-09-03

**You're already prepared!** v3.0.0 implements the new API proactively.

---

## Summary

**v3.0.0: Notion API 2025-09-03**

- ‚ö†Ô∏è **Breaking:** Requires `dataSourceId` in config
- ‚úÖ **Easy migration:** 10 minutes, one config change
- üöÄ **Future-ready:** Prepared for Notion's API enforcement
- üìö **Well-documented:** Complete migration guide included

**Migration:** 10 minutes
**Impact:** Config change required
**Benefit:** Future-proof for new Notion API

---

**Release Notes Version:** 1.0
**Last Updated:** 2025-10-02
**Status:** Implementation Complete, Testing Pending

üéØ **Ready to upgrade? See MIGRATION_v3.md!**
